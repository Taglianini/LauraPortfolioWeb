---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro'; // Importamos el tipo de imagen de Astro

// Definimos la estructura exacta que deben tener tus datos
interface Props {
  images: {
    src: ImageMetadata; // El archivo de imagen importado
    alt: string;        // El texto alternativo
    titulo?: string;    // El título (el '?' significa que es opcional)
  }[];
}

const { images } = Astro.props;
---
<h1 class="text-3xl sm:text-6xl md:text-6xl font-light uppercase tracking-[0.2em] md:tracking-[0.6em] mb-12 -mt-20 text-center pl-[0.2em] md:pl-[0.6em]">
      Pinturas
    </h1>
<div id="mi-galeria" class="relative w-full mx-auto transition-all duration-500 opacity-0" class:list={["opacity-100"]}>
  
  {images.map((imagen) => (
    /* MODIFICACIÓN 1 (EN EL CONTENEDOR PADRE 'absolute'):
       Agregamos 'hover:z-50'. Esto es CRUCIAL. Le dice al navegador: 
       "Cuando el mouse esté aquí, pon este bloque entero por encima de todos los demás".
       También agregamos transición aquí para que el cambio de 'capa' acompañe al zoom.
    */
    <div class="masonry-item absolute top-0 left-0 w-full sm:w-1/2 lg:w-1/3 p-2 hover:z-50 transition-all duration-500 ease-in-out">
      
      {/* MODIFICACIÓN 2 (EN LA TARJETA INTERNA - LA LÍNEA QUE ME PASASTE):
         - Quitamos 'z-0' (ya no hace falta).
         - Cambiamos 'transition-shadow' por 'transition-all' para que anime TAMBIÉN el 'scale'.
         - Cambiamos 'duration-200' a 'duration-500' para que sea lento y elegante.
         - Agregamos 'ease-in-out' para que el movimiento arranque y termine suave.
         - Opcional: Bajé el scale a 105 (hover:scale-105) en lugar de 115. 
           115 suele ser muy agresivo para arte, 105 es más sutil y elegante. ¡Pruébalo!
      */}
      <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-500 ease-in-out hover:scale-105">
        <Image 
          src={imagen.src} 
          alt={imagen.alt} 
          width={600}
          // class="block w-full h-auto object-cover transition-transform duration-700 hover:scale-110"
          class="block w-full h-auto object-cover"
        />
        
        {imagen.titulo && (
          <div class="p-4">
            <h3 class="font-serif text-primary text-lg font-bold uppercase tracking-wider text-center">
                {imagen.titulo}
            </h3>
          </div>
        )}
      </div>

    </div>
  ))}

</div>

<script>
  import MiniMasonry from "minimasonry";

  // Función para iniciar la galería
  function initMasonry() {
    const container = document.getElementById('mi-galeria');
    
    if (container) {
      // 1. Inicializamos MiniMasonry
      const masonry = new MiniMasonry({
        container: container,
        gutter: 0, // El espaciado lo maneja el padding de Tailwind (p-2)
        baseWidth: 280, // Punto de quiebre aproximado
        surroundingGutter: false
      });

      // 2. Truco para que aparezca suavemente (Fade In)
      // A veces masonry tarda milisegundos en calcular, esto evita que se vea "roto" al principio
      container.classList.remove('opacity-0');
      
      // 3. Forzar recalculo después de que las imágenes carguen (por seguridad)
      // Esto arregla bugs visuales si las imágenes tardan en bajar
      const imgs = container.querySelectorAll('img');
      imgs.forEach(img => {
          if (img.complete) {
              masonry.layout();
          } else {
              img.addEventListener('load', () => masonry.layout());
          }
      });
    }
  }

  // CRÍTICO: Usamos 'astro:page-load' para compatibilidad con ClientRouter
  document.addEventListener('astro:page-load', initMasonry);
  
  // Recalcular en resize de ventana
  window.addEventListener('resize', initMasonry);
</script>